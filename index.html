<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python学習プラットフォーム</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <!-- Header -->
    <header class="header" id="main-header" style="display: none;">
        <div class="header-content">
            <div class="logo" onclick="returnToHome()">🐍 Python学習</div>
            <div class="user-info">
                <img id="user-avatar" class="user-avatar" src="" alt="User Avatar">
                <div class="user-details">
                    <div id="user-name-display" class="user-name"></div>
                    <div id="user-email-display" class="user-email"></div>
                </div>
                <button class="sign-out-btn" onclick="signOut()">ログアウト</button>
                <button class="admin-btn" onclick="toggleAdminPanel()">管理</button>
            </div>
        </div>
    </header>

    <!-- Configuration Warning -->
    <div id="config-warning" style="display: none;">
        <h2>⚠️ 設定が必要です</h2>
        <p>Google OAuth Client IDが設定されていません。</p>
        <p><code>config.js</code>ファイルを編集して、Google Cloud Consoleで取得したClient IDを設定してください。</p>
        <p>詳細は<code>README.md</code>を参照してください。</p>
    </div>

    <!-- Authentication Section -->
    <section id="auth-section">
        <div class="auth-card">
            <h1>🐍 Python学習<br>プラットフォーム</h1>
            <p>Pythonの基礎を楽しく学びましょう！</p>
            <p style="font-size: 0.95rem; color: var(--text-muted);">
                Gmailアカウントでログインして学習を始めてください
            </p>
            <div id="google-signin-button"></div>
        </div>
    </section>

    <!-- Main Content -->
    <main id="main-content">
        <!-- External Link Section -->
        <div class="external-link-section">
            <a href="https://hayashi-daisei-ff-arch.github.io/python_learning_site/" target="_blank"
                class="external-link-btn">
                <span class="external-link-icon">🔗</span>
                初心者用Python学習サイトへ
            </a>
        </div>

        <!-- Course Selection Section -->
        <section id="course-section" class="container">
            <h2 class="section-title">コースを選択してください</h2>
            <div class="course-grid">
                <div class="course-card" onclick="startCourse('python-intro')">
                    <span class="course-icon">🐍</span>
                    <h3>Python入門</h3>
                    <!-- Progress Bar -->
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progress-text">0 / 20 問完了</div>

                    <!-- Progress Stats -->
                    <div class="progress-stats">
                        <div class="stat-card">
                            <div class="stat-label">ユーザー名</div>
                            <div class="stat-value" id="user-name">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">回答済み問題数</div>
                            <div class="stat-value" id="questions-count">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">現在の問題の誤答数</div>
                            <div class="stat-value" id="current-errors">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">合計誤答数</div>
                            <div class="stat-value" id="total-errors">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">平均回答時間</div>
                            <div class="stat-value" id="avg-time">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">経過時間</div>
                            <div class="stat-value" id="elapsed-time">00:00</div>
                        </div>
                    </div>
                </div>
        </section>

        <section id="quiz-section" class="container" style="display: none;">
            <h2 id="course-title" class="section-title"></h2>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-text">0 / 0 問完了</div>

            <!-- Start Screen -->
            <div id="start-screen">
                <h2>学習を始めましょう！</h2>
                <p>このコースには <strong id="total-questions">0</strong> 問の問題があります。</p>

                <div class="info-box">
                    <p><strong>📝 注意事項:</strong></p>
                    <ul style="text-align: left; margin-left: 2rem; margin-top: 0.5rem;">
                        <li>問題はあなた専用の順序で表示されます（再現性あり）</li>
                        <li>正解すると確認コードが表示されます</li>
                        <li>統計は「終了」ボタンを押した後に集計されます</li>
                        <li>途中で終了しても、次回は続きから始められます</li>
                    </ul>
                </div>

                <div class="button-group-vertical">
                    <button class="btn btn-primary btn-full-width" onclick="startQuiz()">スタート</button>
                    <div class="button-group-horizontal">
                        <button class="btn btn-secondary" onclick="returnToCourseSelection()">戻る</button>
                        <button class="btn btn-error" onclick="resetProgress()">リセット</button>
                    </div>
                </div>
            </div>

            <!-- Question Area -->
            <div id="question-area">
                <div class="question-card">
                    <!-- Question Header -->
                    <div class="question-header">
                        <div class="question-number-display">
                            問題 <span id="question-number">1</span> / <span id="question-total">20</span>
                        </div>
                    </div>

                    <!-- Question Text -->
                    <div id="question-text"></div>

                    <!-- Answer Container -->
                    <div id="answer-container"></div>

                    <!-- Feedback Area -->
                    <div id="feedback-area"></div>

                    <!-- Action Buttons -->
                    <div class="button-group">
                        <button id="submit-button" class="btn btn-primary" onclick="submitAnswer()">回答する</button>
                        <button id="next-button" class="btn btn-success" onclick="nextQuestion()"
                            style="display: none;">次の問題へ</button>
                    </div>
                </div>

                <!-- End Session Button -->
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-error" onclick="endSession()">終了</button>
                </div>
            </div>

            <!-- Completion Screen -->
            <div id="completion-screen">
                <div class="completion-icon">🎉</div>
                <h2>お疲れ様でした！</h2>
                <p>すべての問題を完了しました</p>

                <div class="completion-stats">
                    <div class="completion-stat">
                        <span class="completion-stat-label">回答した問題数:</span>
                        <span class="completion-stat-value" id="final-questions">0</span>
                    </div>
                    <div class="completion-stat">
                        <span class="completion-stat-label">合計誤答数:</span>
                        <span class="completion-stat-value" id="final-errors">0</span>
                    </div>
                    <div class="completion-stat">
                        <span class="completion-stat-label">経過時間:</span>
                        <span class="completion-stat-value" id="final-time">0秒</span>
                    </div>
                </div>

                <div class="completion-note">
                    <strong>📊 データ保存について:</strong><br>
                    「終了」ボタンを押すと、学習データがGoogle Sheetsに保存されます。
                </div>

                <div class="button-group">
                    <button class="btn btn-error" onclick="endSession()">終了してデータを保存</button>
                    <button class="btn btn-secondary" onclick="returnToCourseSelection()">コース選択に戻る</button>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin-section" class="container">
            <div class="admin-panel">
                <h2>管理パネル</h2>

                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('questions')">問題一覧</button>
                    <button class="admin-tab" onclick="switchAdminTab('add-question')">問題追加</button>
                    <button class="admin-tab" onclick="switchAdminTab('courses')">コース一覧</button>
                    <button class="admin-tab" onclick="switchAdminTab('add-course')">コース追加</button>
                </div>

                <!-- 問題一覧タブ -->
                <div id="questions-tab" class="admin-tab-content active">
                    <h3>登録済み問題</h3>
                    <div id="questions-list" class="question-list"></div>
                </div>

                <!-- 問題追加タブ -->
                <div id="add-question-tab" class="admin-tab-content">
                    <h3>新しい問題を追加</h3>
                    <div class="form-group">
                        <label>コースID</label>
                        <select id="question-course">
                            <option value="">選択してください</option>
                            <option value="python-intro">python-intro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>問題タイプ</label>
                        <select id="question-type">
                            <option value="single">単一選択</option>
                            <option value="multiple">複数選択</option>
                            <option value="text">記述</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>問題文</label>
                        <textarea id="question-text-input" placeholder="問題文を入力"></textarea>
                    </div>
                    <div class="form-group" id="options-group">
                        <label>選択肢</label>
                        <div id="options-container"></div>
                        <button class="add-option-btn" onclick="addOptionInput()">選択肢を追加</button>
                    </div>
                    <div class="form-group">
                        <label>正解</label>
                        <input type="text" id="question-answer" placeholder="正解を入力（複数選択の場合はカンマ区切り）">
                        <small>複数選択の場合: 選択肢1, 選択肢2</small>
                    </div>
                    <div class="form-group">
                        <label>解説（オプション）</label>
                        <textarea id="question-explanation" placeholder="解説を入力"></textarea>
                    </div>
                    <div class="admin-btn-group">
                        <button class="btn-admin btn-save" onclick="addNewQuestion()">追加</button>
                        <button class="btn-admin btn-cancel" onclick="clearQuestionForm()">クリア</button>
                    </div>
                </div>

                <!-- コース一覧タブ -->
                <div id="courses-tab" class="admin-tab-content">
                    <h3>登録済みコース</h3>
                </div>
                <div id="add-course-tab" class="admin-tab-content">
                    <h3>新しいコースを追加</h3>
                    <div class="form-group">
                        <label>コースID</label>
                        <input type="text" id="course-id" placeholder="例: python-basics">
                    </div>
                    <div class="form-group">
                        <label>コース名</label>
                        <input type="text" id="admin-course-title" placeholder="例: Python基礎">
                    </div>
                    <div class="form-group">
                        <label>説明</label>
                        <textarea id="course-description" placeholder="コースの説明を入力"></textarea>
                    </div>
                    <div class="form-group">
                        <label>アイコン（絵文字）</label>
                        <input type="text" id="course-icon" placeholder="例: 🐍">
                    </div>
                    <div class="admin-btn-group">
                        <button class="btn-admin btn-save" onclick="addNewCourse()">追加</button>
                        <button class="btn-admin btn-cancel" onclick="clearCourseForm()">クリア</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="questions.js"></script>
    <script src="tracker.js"></script>
    <script src="sheets-api.js"></script>
    <script src="admin.js"></script>
    <script src="app.js"></script>

    <script>
        // Show header when user is logged in
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new MutationObserver(() => {
                if (document.getElementById('main-content').style.display === 'block') {
                    document.getElementById('main-header').style.display = 'block';
                } else {
                    document.getElementById('main-header').style.display = 'none';
                }
            });

            observer.observe(document.getElementById('main-content'), {
                attributes: true,
                attributeFilter: ['style']
            });
        });
    </script>
</body>

</html>